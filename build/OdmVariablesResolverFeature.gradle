//Gradle 0.9-rc-1
//Command Example: gradle pdeClean pdeBuild -i -S

apply plugin: "FeaturePde"
apply from : "http://repo.orchestra/plugins-releases-local/com/thalesgroup/gradle/plugins/hudsonjobinfos/1.0/hudsonjobinfos-1.0.gradle"

defaultTasks "pdeBuild"

buildscript { 
  repositories{
    add(new org.apache.ivy.plugins.resolver.URLResolver()) {
      name ="Artifactory"
      url = "http://repo.orchestra/plugins-releases-local"
      addArtifactPattern "$url/[organisation]/[artifact]-([classifier]-)[revision].[ext]"
      addIvyPattern "$url/[organisation]/[artifact]-ivy-[revision].xml"   
      descriptor = "optional"
      checkmodified = true
    }
  }
  dependencies {
    classpath "com.thalesgroup.gradle.plugins:pdePlugin:7.+" 
  }
}

def eclipseVariablesResolverContributionFeature = "com.thalesgroup.orchestra.eclipse.variablesresolver.contribution.feature"

configure(FeaturePde){	
  /* the working directory
   * all plugins and features source code will be fetched here */
  buildDirectory = "${workspace}/work"

  /* enter here all the feature ids that you want to build.
   * the Feature directory name must match the feature ID in feature.xml */
  features = [eclipseVariablesResolverContributionFeature]
    
  // the list of directories containing plugins
  pluginsSrcDirList = ["${workspace}/plugins"]
  // the list of directories containing features
  featuresSrcDirList = ["${workspace}/features"]

  /* timestamp for the build artifacts. this will also be the name of the 
   * output folder for all archives that the build will produce. */
  buildId = timestamp

  // the target platform to use to build the features (the $base folder MUST contain an "eclipse" folder)
  base = "R:/extloc/platform-3.8/eclipse-sdk-3.8.2"
    
  // use .link files instead of the -DpluginPath variable (default is false)
  usePreviousLinks = false

  /* extension locations for the target platform.
   * - if building with eclipse 3.5 (usePreviousLinks = false) 
   *   these values will be passed as the -DpluginPath variable separated by path separators 
   * - if building with eclipse 3.3 (usePreviousLinks = true)
   *   these values will end up in .link files in the target platform */
  extLocations = [
     "platform-3.8/misc"
    ,"platform-3.8/wtp4x-sdk-R-3.4.2-20130208151217"
    ,"OF/5.x/5.4/common"
		,"OF/5.x/5.4/lib"
		,"OF/5.x/5.4/ws"
  ]

  // if paths provided in extLocations are not absolute, gradle will append them to this parameter
  eclipseExtensionsRoot = "R:/extloc"

  /* the eclipse runtime that will execute the build.
   * this location must contain a plugins folder with the PDE plugin in it
   * the PDE bundle is a folder named : org.eclipse.pde.build_${pdeBuildPluginVersion} */
  eclipseLauncher = "R:/launcher/3.8-basebuilder"

  /* additional properties to pass directly as arguments to the PDE command line
   * the arguments will have the form : -Darg=value */
  additionalProperties = [
    "javacSource" : "1.7",
    "javacTarget" : "1.7",
    "javacDebugInfo" : true
  ]
}